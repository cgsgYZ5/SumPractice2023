<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>My first page</title>
    <link rel="stylesheet" href="styles.css" />
    <meta name="viewport" content="width=device-width, user-scalable=no" />
  </head>

  <body>
    <a href="../index.html">back</a>
    <p>FPS:</p>
    <p id="fps">30</p>
    <canvas class="canva" id="glCanvas" width="1000" height="1000"></canvas>
    <script type="module">
      import { system } from "./main.js";
      import { matr } from "./math/matr.js";
      import { vec3 } from "./math/vec3.js";
      import { getTextFromFile } from "./tools/textload.js";
      import { vertConvert } from "./tools/vertConvert.js";

      window.addEventListener("load", () => {
        let sys = system("glCanvas");
        let mtl = sys.render.mtlCreate(
          "./bin/shaders/3d",
          ["P", { P: 3, T: 2 }],

          { Ka: [1, 1, 1], Kd: [1, 2, 3], Ks: [90, 12, 45], Ph: 1 },

          [
            "uSampler1",
            "uSampler2",
            {
              uSampler1: "bin/textures/M.bmp",
              uSampler2: "bin/textures/D1.bmp",
            },
          ]
        );
        let mtl2 = sys.render.mtlCreate(
          "./bin/shaders/3d",
          ["P", { P: 3 }],

          {
            Ka: [1, 1, 1],
            Kd: [1, 2, 3],
            Ks: [90, 12, 45],
            Ph: 1,
            Tex: [0, 0],
          },
          null
        );
        let prim;
        let prim2;

        getTextFromFile("./coords/tetrahedron.txt").then((res) => {
          let primCreateMass = vertConvert(res);
          prim = sys.render.primCreate(
            "triangle",
            primCreateMass[0],
            primCreateMass[1],
            mtl
          );
          prim.draw(matr().translate(vec3(2, 0, 0)));
        });
        getTextFromFile("./coords/hexahedron.txt").then((res) => {
          let primCreateMass = vertConvert(res);
          prim2 = sys.render.primCreate(
            "triangle",
            primCreateMass[0],
            primCreateMass[1],
            mtl2
          );
          prim2.draw(matr().translate(vec3(-2, 0, 0)));
        });
        getTextFromFile("./coords/octahedron.txt").then((res) => {
          let primCreateMass = vertConvert(res);
          prim2 = sys.render.primCreate(
            "triangle",
            primCreateMass[0],
            primCreateMass[1],
            mtl2
          );
          prim2.draw(matr());
        });

        const def = vec3(0, 0, 3);
        let loc = vec3(0, 0, 3);

        const draw = () => {
          /*
                sys.render.camera.set(loc, vec3(0), vec3(0, 1, 0));
                
                loc = matr().rotateY(sys.render.timer.globalTime / 15 * 360).pointTransform(def);
                */
          sys.render.start();

          sys.render.end();
          window.requestAnimationFrame(draw);
        };
        draw();
      });
    </script>
    <form name="slide" method="get">
      <input id="slider1" type="range" min="-60" max="60" step="0.01" />
      <input id="button1" type="button" />
    </form>
  </body>
</html>
